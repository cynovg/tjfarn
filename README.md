## Задание

Напишите класс/модуль для реализации транзакций в perl в конкурентной среде из нескольких процессов,
например, чтобы можно было откатить изменения сделанные несколькими функциями или сохранить
эти изменения пачкой, учитывая одновременный доступ из нескольких процессов.
Задача не про БД а про атомарные операции

## Решение

Модуль `TJFARN::Transaction` отвечает за работу с базой в рамках одной транзакции. Для каждого экземпляра объекта создается собственный хендлер, из условий задачи не ясны требования к подключениям. Если будет желание переиспользовать существующее подключение, то придется где-то хранить объект между циклами записи, но это не проблема, самый простой способ - заменить `my $tns` на `state $tns` если позволяет версия, иначе где-то за пределами функции `add_user`. И убрать блок `DESCTROY`, в некоторых случаях он сам может быть проблемой, т.к. к момент уничтожения объекта хендлера базы уже может не быть.

Метод `process` принимает коллбэк-функции и аргументы для нее. Вызовы будут выполнены в рамках одной транзации до тех пор, пока не будет вызван метод `finish`, который завершает текущую транзакцию. Для запуска транзакции никаких особенных действий производить не надо.

В качестве примера добавить скрипт `bin/add_user.pl`, который добавляет запись в таблицу `user` и логирует добавление пользователя.

### DDL

```
CREATE TABLE `user` (
    `id` MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(128) NOT NULL,
    `status` BOOLEAN,
    PRIMARY KEY `mid`(`id`)
);
```

```
CREATE TABLE `log` (
    `id` MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
    `user_id` MEDIUMINT UNSIGNED NOT NULL,
    `updated` TIMESTAMP NOT NULL DEFAULT NOW(),
    PRIMARY KEY `mid` (`id`),
    KEY `uid` (`user_id`)
);
```

